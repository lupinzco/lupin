<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>페이지를 찾을 수 없습니다</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, sans-serif; }
    .wrap { height: 100%; display: flex; align-items: center; justify-content: center; text-align: center; padding: 24px; }
    .card { max-width: 520px; }
    .muted { color: #6b7280; margin-top: 8px; }
    .btn { display: inline-block; margin-top: 16px; padding: 10px 16px; background: #6d28d9; color: #fff; border-radius: 10px; text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>페이지를 찾을 수 없습니다</h1>
      <p class="muted">잠시 후 홈으로 이동합니다...</p>
      <a id="homeLink" class="btn" href="/lupin/">홈으로 가기</a>
    </div>
  </div>
  <script>
    // GitHub Pages SPA + App handoff
    (function () {
      function getBase() { return '/lupin/'; }

      function getId() {
        var q = new URLSearchParams(window.location.search);
        var id = q.get('id');
        if (id) return id;
        var hash = window.location.hash || '';
        // #id
        if (/^#\w+/.test(hash)) return hash.slice(1);
        // #/post/123
        var m = hash.match(/^#\/?post\/(\w[\w-]*)/);
        return m ? m[1] : null;
      }

      function openWeb(id) {
        var base = getBase();
        var target = id ? (base + '#/post/' + encodeURIComponent(id)) : base;
        window.location.replace(target);
      }

      function tryOpenApp(id) {
        if (!id) return false;
        var schemeUrl = 'lupin://post/' + encodeURIComponent(id);
        var intentUrl = 'intent://post/' + encodeURIComponent(id) +
          '#Intent;scheme=lupin;package=com.lupin.app;S.browser_fallback_url=' + encodeURIComponent(location.origin + getBase() + '#/post/' + encodeURIComponent(id)) + ';end';

        var started = Date.now();
        var timer = setTimeout(function () {
          // If still here within 1.2s, try Android intent as secondary
          // Then fallback to web
          if (/(Android)/i.test(navigator.userAgent)) {
            try { window.location.href = intentUrl; } catch (_) {}
            setTimeout(function(){ openWeb(id); }, 800);
          } else {
            openWeb(id);
          }
        }, 1200);

        // Prefer direct navigation to increase success in in-app browsers
        try { window.location.href = schemeUrl; } catch (_) {}

        // If visibility changes (app switch), cancel fallback
        document.addEventListener('visibilitychange', function () {
          if (document.hidden) clearTimeout(timer);
        });
        return true;
      }

      var id = getId();
      // Attempt app handoff first when possible
      if (!tryOpenApp(id)) {
        openWeb(id);
      }
    })();
  </script>
</body>
</html>
