<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>페이지를 찾을 수 없습니다</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, sans-serif; }
    .wrap { height: 100%; display: flex; align-items: center; justify-content: center; text-align: center; padding: 24px; }
    .card { max-width: 520px; }
    .muted { color: #6b7280; margin-top: 8px; }
    .btn { display: inline-block; margin-top: 16px; padding: 10px 16px; background: #6d28d9; color: #fff; border-radius: 10px; text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>페이지를 찾을 수 없습니다</h1>
      <p class="muted">잠시 후 홈으로 이동합니다...</p>
      <a id="homeLink" class="btn" href="/lupin/">홈으로 가기</a>
    </div>
  </div>
  <script>
    // GitHub Pages SPA + App handoff
    (function () {
      function getBase() { return '/lupin/'; }
      // Store URLs (iOS URL은 실제 앱 ID로 교체 필요)
      var ANDROID_STORE = 'https://play.google.com/store/apps/details?id=com.lupin.app';
      var IOS_STORE = ''; // 예: 'https://apps.apple.com/app/id1234567890'

      function getId() {
        var q = new URLSearchParams(window.location.search);
        var id = q.get('id');
        if (id) return id;
        var hash = window.location.hash || '';
        // #id
        if (/^#\w+/.test(hash)) return hash.slice(1);
        // #/post/123
        var m = hash.match(/^#\/?post\/(\w[\w-]*)/);
        return m ? m[1] : null;
      }

      function openWeb(id) {
        var base = getBase();
        var target = id ? (base + '#/post/' + encodeURIComponent(id)) : base;
        window.location.replace(target);
      }

      function tryOpenApp(id) {
        var base = getBase();
        var isAndroid = /(Android)/i.test(navigator.userAgent);
        // If id가 없거나 잘못된 경우에도 앱을 홈으로 실행 시도
        var schemeUrl = id ? ('lupin://post/' + encodeURIComponent(id)) : 'lupin://';
        var fallbackWeb = id ? (location.origin + base + '#/post/' + encodeURIComponent(id)) : (location.origin + base);
        // Android: 미설치 시 Play 스토어로 이동
        var fallbackAndroid = ANDROID_STORE || fallbackWeb;
        var intentUrl = 'intent://' + (id ? ('post/' + encodeURIComponent(id)) : '') +
          '#Intent;scheme=lupin;package=com.lupin.app;S.browser_fallback_url=' + encodeURIComponent(fallbackAndroid) + ';end';

        var started = Date.now();
        var timer = setTimeout(function () {
          // If still here within 1.2s, try Android intent as secondary
          // Then fallback to web (홈 또는 게시글)
          if (isAndroid) {
            try { window.location.href = intentUrl; } catch (_) {}
            // intent의 fallback이 Play 스토어로 처리되므로 추가 웹 폴백은 대기
          } else {
            // iOS: 미설치 시 App Store로 보내고, 미설치 URL이 없다면 웹 폴백
            if (IOS_STORE && typeof IOS_STORE === 'string' && IOS_STORE.length > 0) {
              try { window.location.href = IOS_STORE; } catch (_) { openWeb(id); }
            } else {
              openWeb(id);
            }
          }
        }, 1200);

        // Prefer direct navigation to increase success in in-app browsers
        try { window.location.href = schemeUrl; } catch (_) {}

        // If visibility changes (app switch), cancel fallback
        document.addEventListener('visibilitychange', function () {
          if (document.hidden) clearTimeout(timer);
        });
        return true;
      }

      var id = getId();
      // Attempt app handoff first when possible
      if (!tryOpenApp(id)) {
        openWeb(id);
      }
    })();
  </script>
</body>
</html>
